oes.space={grid:{directions:["N","NE","E","SE","S","SW","W","NW"],getRandomDirection:function(){return this.directions[rand.uniformInt(0,7)]},i:{},o:{}},oneDim:{},twoDim:{},threeDim:{},dimensions:{"1D":1,"1D-Grid":1,IntegerGrid:2,ObjectGrid:2,"2D":2,"3D":3,"3D-Grid":3}},oes.space.initialize=function(){var e=sim.model.space;switch(e.geometry||(e.geometry="TOROIDAL"),e.type){case"1D":break;case"IntegerGrid":oes.space.grid.forAllCells=oes.space.grid.i.forAllCells,oes.space.grid.i.initialize(e.xMax,e.yMax);break;case"ObjectGrid":oes.space.grid.forAllCells=oes.space.grid.o.forAllCells,oes.space.grid.o.initialize(e.xMax,e.yMax);break;case"2D":e.overlayGridCellSize&&(sim.space.overlayGrid.cellSize=e.overlayGridCellSize,oes.space.overlayGrid.initialize(e.xMax,e.yMax,sim.space.overlayGrid.cellSize))}},oes.space.grid.i.initialize=function(e,i){sim.space.grid=new Uint8Array(e*i)},oes.space.grid.i.forAllCells=function(e){var i=sim.model.space.xMax,s=sim.model.space.yMax,r=0,a=0;for(r=1;r<=s;r++)for(a=1;a<=i;a++)e(a,r,sim.space.grid[(r-1)*i+a-1])},oes.space.grid.i.getCellValue=function(e,i){var s=sim.model.space.xMax;return sim.space.grid[(i-1)*s+e-1]},oes.space.grid.i.setCellValue=function(e,i,s){var r=sim.model.space.xMax;sim.space.grid[(i-1)*r+e-1]=s},oes.space.grid.i.isFreeCell=function(e,i){var s=sim.model.space.xMax;return 0===sim.space.grid[(i-1)*s+e-1]},oes.space.grid.i.isSetBit0=function(e,i){var s=sim.model.space.xMax;return 1&sim.space.grid[(i-1)*s+e-1]},oes.space.grid.i.setBit0=function(e,i){var s=sim.model.space.xMax;sim.space.grid[(i-1)*s+e-1]|=1},oes.space.grid.i.unsetBit0=function(e,i){var s=sim.model.space.xMax;sim.space.grid[(i-1)*s+e-1]&=-2},oes.space.grid.i.getNmrOfNeighborCellsWithBit0=function(e,i){var s,r,a,o,t=sim.model.space.xMax,c=sim.model.space.yMax,l=0;return a=i<c?i+1:1,s=e<t?e+1:1,o=i>1?i-1:c,r=e>0?e-1:t,l+=1&sim.space.grid[(a-1)*t+e-1],l+=1&sim.space.grid[(a-1)*t+s-1],l+=1&sim.space.grid[(i-1)*t+s-1],l+=1&sim.space.grid[(o-1)*t+s-1],l+=1&sim.space.grid[(o-1)*t+e-1],l+=1&sim.space.grid[(o-1)*t+r-1],l+=1&sim.space.grid[(i-1)*t+r-1],l+=1&sim.space.grid[(a-1)*t+r-1]},oes.space.grid.i.findFreeCell=function(e){for(var i=(sim.space.grid,sim.model.space.xMax),s=sim.model.space.yMax,r=e?e[0]:rand.uniformInt(1,i),a=e?e[1]:rand.uniformInt(1,s),o=0,t=0;sim.space.grid[(a-1)*i+r-1]>0;)if(r=r<i?r+1:1,o+=1,o>=i-1&&(a=a<s?a+1:1,o=0,t+=1),t>=s-1)throw"Attempt to over-populate grid!";return[r,a]},oes.space.grid.i.move=function(e,i){var s=sim.model.space.xMax,r=e[0],a=e[1],o=sim.space.grid[(a-1)*s+r-1];sim.space.grid[(a-1)*s+r-1]=0,r=i[0],a=i[1],sim.space.grid[(a-1)*s+r-1]=o},oes.space.grid.o.initialize=function(e,i){var s=null,r=0,a=0,o=null;if(oes.space.grid.getCell=oes.space.grid.o.getCell,oes.space.grid.move=oes.space.grid.o.move,sim.space.grid=s=new Array(e),"object"==typeof sim.model.space.gridCellProperties)for(sim.model.space.gridCellProperties.objects={range:Object,initialValue:{}},sim.model.space.gridCellProperties.pos={range:Array,label:"Position"},o=new cLASS({Name:"GridCell",properties:sim.model.space.gridCellProperties,methods:{addObject:function(e){e.pos=this.pos,this.objects[String(e.id)]=e},removeObject:function(e){delete this.objects[String(e.id)]}}}),r=0;r<e;r++)for(s[r]=new Array(i),a=0;a<i;a++)s[r][a]=new o({pos:[r+1,i-a]})},oes.space.grid.o.forAllCells=function(e){var i=sim.model.space.xMax,s=sim.model.space.yMax,r=0,a=0,o=null;for(r=1;r<=i;r++)for(a=1;a<=s;a++)o=oes.space.grid.o.getCell(r,a),e(r,a,o)},oes.space.grid.o.move=function(e,i){},oes.space.grid.o.getCell=function(e,i){return sim.space.grid[e-1][sim.model.space.yMax-i]},oes.space.overlayGrid={},oes.space.overlayGrid.initialize=function(e,i,s){var r=0,a=0;s=s||1,r=parseInt(e/s),a=parseInt(i/s),oes.space.grid.o.initialize(r,a)},oes.space.overlayGrid.forAllCells=function(e){var i=sim.model.space.overlayGridCellSize,s=parseInt(sim.model.space.xMax/i),r=parseInt(sim.model.space.yMax/i),a=0,o=0;for(a=0;a<s;a++)for(o=0;o<r;o++)e(a+1,o+1,sim.space.grid[a][o])},oes.space.overlayGrid.getCell=function(e,i){var s=sim.space.overlayGrid.cellSize||1,r=parseInt(sim.model.space.yMax/s);return e=parseInt(e/s),i=parseInt(i/s),sim.space.grid[e][r-i-1]},oes.ObjectInGridSpace=new cLASS({Name:"ObjectInGridSpace",supertypeName:"oBJECT",properties:{pos:{range:Array,initialValue:[0,0],label:"Position"}},methods:{moveToCell:function(e,i){var s=sim.model.space.xMax,r=sim.model.space.yMax,a=this.pos[0],o=this.pos[1];"EUCLIDEAN"===sim.model.space.geometry?(e<1?e=1:e>s&&(e=s),i<1?i=1:i>r&&(i=r)):(e<1?e=s+e:e>s&&(e%=s),i<1?i=r+i:i>r&&(i%=r)),delete sim.space.grid[a][o].objects[String(this.id)],this.pos[0]=e,this.pos[1]=i,sim.space.grid[e][i].objects[String(this.id)]=this},moveToCellIfFree:function(e,i){return 0===Object.keys(sim.space.grid[e][i].objects).length&&(this.moveToCell(e,i),!0)},moveInDirection:function(e){var i=oes.space.grid.getTranslationPosition(this.pos[0],this.pos[1],e);this.moveToCell(i[0],i[1])},moveInRandomDirection:function(){var e=oes.space.grid.directions[rand.uniformInt(0,7)];this.moveInDirection(e)}}});var ObjectInOneDimSpace=new cLASS({Name:"ObjectInOneDimSpace",supertypeName:"oBJECT",properties:{pos:{range:cLASS.Array("Decimal",2)},vel:{range:cLASS.Array("Decimal",2)},acc:{range:cLASS.Array("Decimal",2)}},methods:{computeNextVelocity:function(){return this.vel[0]+this.acc[0]*sim.timeIncrement},computeNextPosition:function(){return this.pos[0]+this.vel[0]*sim.timeIncrement}}});oes.ObjectInTwoDimSpace=new cLASS({Name:"ObjectInTwoDimSpace",supertypeName:"oBJECT",properties:{pos:{range:Array,initialValue:[0,0],label:"Position"},width:{range:"Decimal",initialValue:0,label:"Width"},height:{range:"Decimal",initialValue:0,label:"Height"}},methods:{}});